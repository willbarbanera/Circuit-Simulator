<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Physics: Circuit Lab</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; background: #121212; color: #e0e0e0; margin: 0; overflow: hidden; }
        #toolbar { background: #1f1f1f; padding: 15px; width: 100%; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; border-bottom: 3px solid #333; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .tool { padding: 10px 16px; background: #333; border: 1px solid #444; color: #fff; cursor: pointer; border-radius: 6px; font-weight: 600; transition: all 0.2s; }
        .tool:hover { background: #444; border-color: #666; }
        .tool.active { background: #f1c40f; color: #000; border-color: #d4ac0d; }
        canvas { background: #ffffff; border-radius: 8px; margin-top: 20px; cursor: crosshair; box-shadow: inset 0 0 10px rgba(0,0,0,0.2); }
        #meter-readout { position: absolute; background: rgba(0, 20, 0, 0.9); color: #00ff00; padding: 12px; border: 2px solid #00ff00; border-radius: 8px; pointer-events: none; display: none; font-family: 'Courier New', Courier, monospace; font-size: 15px; z-index: 1000; box-shadow: 0 0 15px rgba(0,255,0,0.3); }
        .hint { margin-top: 10px; color: #888; font-size: 0.85rem; }
    </style>
</head>
<body>

<div id="toolbar">
    <button class="tool" onclick="addComponent('battery', 9)">&#128267; 9V Battery</button>
    <button class="tool" onclick="addComponent('bulb', 10)">&#128161; Lightbulb (10&Omega;)</button>
    <button class="tool" onclick="addComponent('resistor', 20)">&#127937; Resistor (20&Omega;)</button>
    <button class="tool" onclick="addComponent('resistor', 50)">&#127937; Resistor (50&Omega;)</button>
    <button class="tool" onclick="addComponent('switch', 0)">&#128268; Switch</button>
    <button class="tool" id="meterBtn" onclick="toggleMeter()">&#128256; Multimeter</button>
    <button class="tool" onclick="clearAll()" style="background: #c0392b; border-color: #a93226;">Reset Lab</button>
</div>

<canvas id="circuitCanvas" width="950" height="550"></canvas>
<div id="meter-readout"></div>

<p class="hint">Click nodes to connect wires. Click the switch to toggle power. Use the multimeter to probe parts.</p>

<script>
    const canvas = document.getElementById('circuitCanvas');
    const ctx = canvas.getContext('2d');
    const meterReadout = document.getElementById('meter-readout');
    const meterBtn = document.getElementById('meterBtn');

    let components = [];
    let wires = [];
    let dragObj = null;
    let drawingWireFrom = null;
    let meterActive = false;
    let currentFlow = 0;

    function addComponent(type, val) {
        components.push({
            type, x: 50, y: 50, w: 100, h: 60,
            v: type === 'battery' ? val : 0,
            r: (type === 'bulb' || type === 'resistor') ? val : 0.01,
            isOpen: type === 'switch' ? true : false,
            glow: 0,
            val: val
        });
        updatePhysics();
        draw();
    }

    function drawBattery(x, y) {
        ctx.fillStyle = "#2c3e50";
        ctx.fillRect(x + 10, y, 70, 45);
        ctx.fillStyle = "#bdc3c7";
        ctx.fillRect(x + 20, y - 8, 15, 8); // Negative terminal
        ctx.fillRect(x + 55, y - 8, 15, 8); // Positive terminal
        ctx.fillStyle = "#ecf0f1";
        ctx.font = "bold 14px Arial";
        ctx.fillText("9V DC", x + 25, y + 28);
    }

    function drawBulb(x, y, glow) {
        // Base
        ctx.fillStyle = "#95a5a6";
        ctx.fillRect(x + 35, y + 35, 30, 15);
        // Glass
        ctx.beginPath();
        ctx.arc(x + 50, y + 20, 22, 0, Math.PI * 2);
        if (glow > 0) {
            ctx.shadowBlur = 40 * glow;
            ctx.shadowColor = "#f1c40f";
            ctx.fillStyle = `rgba(255, 255, 180, ${0.4 + glow * 0.6})`;
        } else {
            ctx.fillStyle = "rgba(230, 230, 230, 0.3)";
        }
        ctx.fill();
        ctx.shadowBlur = 0;
        ctx.strokeStyle = "#444";
        ctx.lineWidth = 2;
        ctx.stroke();
        // Filament
        ctx.beginPath();
        ctx.moveTo(x + 42, y + 25);
        ctx.bezierCurveTo(x + 45, y + 5, x + 55, y + 5, x + 58, y + 25);
        ctx.strokeStyle = glow > 0 ? "#e67e22" : "#7f8c8d";
        ctx.stroke();
    }

    function drawSwitch(x, y, isOpen) {
        ctx.fillStyle = "#34495e";
        ctx.fillRect(x + 10, y + 40, 80, 8);
        ctx.strokeStyle = "#2c3e50";
        ctx.lineWidth = 5;
        ctx.lineCap = "round";
        ctx.beginPath();
        ctx.moveTo(x + 20, y + 40);
        if (isOpen) {
            ctx.lineTo(x + 60, y + 5);
        } else {
            ctx.lineTo(x + 80, y + 40);
        }
        ctx.stroke();
    }

    function drawResistor(x, y, val) {
        ctx.fillStyle = "#f3e5ab"; // Resistor body color
        ctx.beginPath();
        ctx.roundRect(x + 15, y + 20, 70, 20, 10);
        ctx.fill();
        ctx.strokeStyle = "#d4ac0d";
        ctx.stroke();
        // Color bands (representing resistance)
        const colors = val === 20 ? ["#8b4513", "#ff0000", "#000000"] : ["#008000", "#000000", "#000000"];
        colors.forEach((color, i) => {
            ctx.fillStyle = color;
            ctx.fillRect(x + 30 + (i * 15), y + 20, 6, 20);
        });
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Draw Grid lines for "Drafting" look
        ctx.strokeStyle = "#f0f0f0";
        ctx.lineWidth = 1;
        for(let i=0; i<canvas.width; i+=25) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke(); }
        for(let i=0; i<canvas.height; i+=25) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); ctx.stroke(); }

        // Wires
        wires.forEach(w => {
            ctx.strokeStyle = currentFlow > 0 ? "#3498db" : "#444"; 
            ctx.lineWidth = 5;
            ctx.beginPath(); ctx.moveTo(w.x1, w.y1); ctx.lineTo(w.x2, w.y2); ctx.stroke();
        });

        components.forEach(c => {
            if (c.type === 'battery') drawBattery(c.x, c.y);
            else if (c.type === 'bulb') drawBulb(c.x, c.y, c.glow);
            else if (c.type === 'switch') drawSwitch(c.x, c.y, c.isOpen);
            else if (c.type === 'resistor') drawResistor(c.x, c.y, c.val);

            // Connection Terminals
            ctx.fillStyle = "#c0392b"; // Left Node
            ctx.beginPath(); ctx.arc(c.x, c.y + 30, 7, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = "#2c3e50"; // Right Node
            ctx.beginPath(); ctx.arc(c.x + 100, c.y + 30, 7, 0, Math.PI*2); ctx.fill();
        });
    }

    function updatePhysics() {
        const hasBattery = components.some(c => c.type === 'battery');
        const anySwitchOpen = components.some(c => c.type === 'switch' && c.isOpen);
        const isClosedLoop = wires.length >= components.length && !anySwitchOpen;

        if (isClosedLoop && hasBattery) {
            let totalR = components.reduce((sum, c) => sum + (c.r || 0), 0);
            currentFlow = 9 / totalR;
            components.forEach(c => { if(c.type === 'bulb') c.glow = Math.min(currentFlow * 6, 1); });
        } else {
            currentFlow = 0;
            components.forEach(c => c.glow = 0);
        }
    }

    function toggleMeter() {
        meterActive = !meterActive;
        meterBtn.classList.toggle('active');
        if(!meterActive) meterReadout.style.display = 'none';
    }

    canvas.onmousedown = (e) => {
        const { offsetX: mx, offsetY: my } = e;
        
        components.forEach(c => {
            if (c.type === 'switch' && mx > c.x && mx < c.x + c.w && my > c.y && my < c.y + c.h) {
                c.isOpen = !c.isOpen; updatePhysics(); draw(); return;
            }
        });

        components.forEach(c => {
            if (Math.hypot(mx - c.x, my - (c.y + 30)) < 15) drawingWireFrom = { x: c.x, y: c.y + 30 };
            if (Math.hypot(mx - (c.x + 100), my - (c.y + 30)) < 15) drawingWireFrom = { x: c.x + 100, y: c.y + 30 };
        });

        if (!drawingWireFrom) {
            components.forEach(c => {
                if (mx > c.x && mx < c.x + c.w && my > c.y && my < c.y + c.h) dragObj = c;
            });
        }
    };

    canvas.onmousemove = (e) => {
        const { offsetX: mx, offsetY: my, clientX: cx, clientY: cy } = e;
        
        if (meterActive) {
            let found = components.find(c => mx > c.x && mx < c.x + c.w && my > c.y && my < c.y + c.h);
            if (found) {
                meterReadout.style.display = 'block';
                meterReadout.style.left = (cx + 20) + 'px';
                meterReadout.style.top = (cy + 20) + 'px';
                let voltage = found.type === 'battery' ? 9.00 : (currentFlow * found.r);
                meterReadout.innerHTML = `&gt; VOLT: ${voltage.toFixed(2)}V<br>&gt; CURR: ${currentFlow.toFixed(2)}A<br>&gt; RESI: ${found.r}&Omega;`;
            } else { meterReadout.style.display = 'none'; }
        }

        if (dragObj) { dragObj.x = mx - 50; dragObj.y = my - 30; draw(); }
    };

    canvas.onmouseup = (e) => {
        if (drawingWireFrom) {
            const { offsetX: mx, offsetY: my } = e;
            components.forEach(c => {
                if (Math.hypot(mx - c.x, my - (c.y + 30)) < 20) wires.push({ x1: drawingWireFrom.x, y1: drawingWireFrom.y, x2: c.x, y2: c.y + 30 });
                if (Math.hypot(mx - (c.x + 100), my - (c.y + 30)) < 20) wires.push({ x1: drawingWireFrom.x, y1: drawingWireFrom.y, x2: c.x + 100, y2: c.y + 30 });
            });
            updatePhysics();
        }
        dragObj = null; drawingWireFrom = null; draw();
    };

    function clearAll() { components = []; wires = []; currentFlow = 0; draw(); }
</script>
</body>
</html>